<!DOCTYPE html>
<!--

  KNOWN BUGS:
   tab squishing <â€¢>
    = tabs with a name that doens't fit into the min-width will be squished as soon as there is no room left in the tabs container
    - type: display (or logic)
    - level: minor (or major)

-->
<html>
  <head>
    <title>ReEdit</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&display=swap">
    <!--<link rel="stylesheet" href="stylesheet.css">-->
    <link rel="icon" href="resources/favicon.ico">
    <style>
      /* Transitions */
      @keyframes shadow-in {
        from {
          box-shadow: 0px 0px 0px rgba(0, 0, 0, 0);
        }
        to {
          box-shadow: 0px 0px 10px rgba(200, 200, 200, 0.5);
        }
      }
      @keyframes slide-top {
        from {
          top: -100px;
        }
        to {
          top: 0px;
        }
      }
      @keyframes slide-left {
        from {
          left: calc(-20% - 50px);
          top: -150px;
          height: 100vh;
        }
        to {
          left: 0px;
          top: 0px;
          height: calc(100vh - 150px);
        }
      }
      @keyframes fade-in {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .t0-5 {
        -webkit-transition: all 0.5s cubic-bezier(0.2, 0.6, 0.3, 1);
        -moz-transition: all 0.5s cubic-bezier(0.2, 0.6, 0.3, 1);
        -o-transition: all 0.5s cubic-bezier(0.2, 0.6, 0.3, 1);
        -ms-transition: all 0.5s cubic-bezier(0.2, 0.6, 0.3, 1);
        transition: all 0.5s cubic-bezier(0.2, 0.6, 0.3, 1);
      }

      /* Styling */
      * {
        font-family: "Roboto";
        font-weight: 300;
      }
      body {
        background-color: rgb(255, 255, 255);
        margin: 0px;
        padding: 0px;
        height: 100vh;
        /*overflow: hidden;*/
      }

      h1 {
        margin: 0px;
        font-weight: 400;
      }

      /* Options / Option Icons */
      .icon {
        width: 30px;
        height: 30px;
      }
      .options-container {
        display: flex;
      }
      .icon-container, .icon-container-close {
        background-color: rgba(0, 0, 0, 0);
        width: 30px;
        height: 30px;
        padding: 10px;
        margin-left: 25px;
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.5s;
      }
      .icon-container:hover, .icon-container-close:hover {
        background-color: rgb(225, 225, 225);
        cursor: pointer;
      }
      .icon-container-close {
        position: absolute;
        top: 25px;
        right: 50px;
      }
      .account-icon-container-close {
        margin-right: 75px;
      }
      .download-icon-container-close {
        margin-right: 150px;
      }
      .run-icon {
        transform: rotate(-90deg);
        /* display: none; */
      }

      /* Cover */
      .cover {
        position: absolute;
        background-color: rgba(0, 0, 0, 0);
        width: calc(100vw - 200px);
        height: calc(100vh - 200px);
        margin: 0px;
        padding: 100px;
        top: 0px;
        left: 0px;
        opacity: 0;
        z-index: 3;
        pointer-events: none;
      }
      .cover-active {
        background-color: rgba(250, 250, 250, 1);
        opacity: 1;
      }
      .settings, .account, .download {
        position: absolute;
        width: calc(100vw - 200px);
        height: calc(100vh - 200px);
        margin: 0px;
        padding: 100px;
        top: 0px;
        left: 0px;
        opacity: 0;
        pointer-events: none;
      }
      .settings-active, .account-active, .download-active {
        opacity: 1;
      }

      /* Header */
      .header {
        position: relative;
        background-color: rgb(250, 250, 250);
        width: calc(100vw - 100px);
        height: 50px;
        line-height: 50px;
        margin: 0px;
        padding: 25px 50px 25px 50px;
        animation: slide-top 2s forwards, 2s shadow-in 2s forwards;
        z-index: 2;
        display: flex;
      }
      .main-icon {
        width: 50px;
        height: 50px;
        margin-right: 25px;
      }
      .header-text {
        flex-grow: 1;
      }

      /* Content */
      .content {
        display: flex;
        background-color: rgb(255, 255, 255);
        width: 100%;
        height: calc(100vh - 100px);
        margin: 0px;
        padding: 0px;
      }

      /* Sidebar: */
      .sidebar {
        display: flex;
        position: relative;
        background-color: rgb(250, 250, 250);
        width: 20vw;
        margin: 0px;
        padding: 25px;
        animation: slide-left 2s forwards, 2s shadow-in 2s forwards;
        z-index: 1;
        overflow: hidden;
        flex-direction: column;
      }
      .sidebar-tools-container {
        display: flex;
        width: calc(100% - 20px);
        margin: 0px 0px 15px 0px;
        padding: 10px;
        flex-direction: column;
      }
      .sidebar-search {
        background-color: rgb(255, 255, 255);
        width: calc(100% - 20px);
        margin: 0px;
        padding: 9px;
        border: 1px solid rgba(0, 0, 0, 0);
        border-radius: 10px;
        transition: all 0.5s;
      }
      .sidebar-search:focus {
        outline: none;
        border: 1px solid rgba(200, 200, 200, 0.5);
      }
      .sidebar-options-container {
        display: flex;
        width: 100%;
        margin: 0px;
        padding: 0px;
      }
      .sidebar-option-TEMPORARY {
        flex-grow: 1;
        text-align: center;
        border: 1px solid black;
      }
      .sidebar-files {
        width: 100%;
        margin: 0px;
        padding: 0px;
        overflow: auto;
      }
      .sidebar-folder-container {
        margin: 0px;
        padding: 0px;
      }
      .sidebar-folder, .sidebar-file {
        background-color: rgb(250, 250, 250);
        padding: 10px;
        border-radius: 10px;
        transition: all 0.5s;
      }
      .sidebar-folder:hover, .sidebar-file:hover {
        background-color: rgb(225, 225, 225);
        cursor: pointer;
      }
      .sidebar-folder:active, .sidebar-file:active {
        background-color: rgb(200, 200, 200);
        cursor: pointer;
        /*box-shadow: 0px 0px 10px rgba(200, 200, 200);*/
      }
      .sidebar-open {
        background-color: rgb(240, 240, 240);
      }
      .sidebar-linked {
        background-color: rgb(225, 225, 225);
      }
      .sidebar-folder-contents {
        background-color: rgb(250, 250, 250);
        padding: 0px 0px 0px 25px;
        overflow-x: auto;
      }
      .sidebar-folder-contents-active {
        height: 0px;
      }
      .sidebar::selection, .sidebar-folder::selection, .sidebar-file::selection {
        background-color: rgba(0, 0, 0, 0);
      }

      /* Editor */
      .editor-container {
        width: calc(100vw - 20% - 50px);
        display: flex;
        flex-direction: column;
        margin: 0px;
        padding: 0px;
        opacity: 0;
        animation: 2s fade-in 2s forwards;
      }
      .editor-tabs {
        display: flex;
        background-color: rgb(250, 250, 250);
        min-width: 100%;
        height: 50px;
        margin: 0px;
        padding: 0px;
        overflow-x: auto;
      }
      .editor-tab {
        background-color: rgb(250, 250, 250);
        min-width: 100px;
        height: 30px;
        margin: 0px;
        padding: 10px;
        text-align: center;
        line-height: 30px;
        transition: all 0.5s, border 0s;
        /* Fix animation fragments: */
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        -moz-backface-visibility: hidden;
      }
      .editor-tab:hover {
        background-color: rgb(225, 225, 225);
        cursor: pointer;
      }
      .editor-tab:active {
        background-color: rgb(200, 200, 200);
        cursor: pointer;
      }
      .editor-tab-open {
        background-color: rgb(255, 255, 255);
      }
      .editor-tab-linked {
        background-color: rgb(225, 225, 225);
      }
      .editor-tab-over-left {
        border-left: 5px solid rgb(0, 0, 0);
      }
      .editor-tab-over-right {
        border-right: 5px solid rgb(0, 0, 0);
      }
      .editor-text-container {
        background-color: rgb(255, 255, 255);
        width: calc(100% - 50px);
        height: calc(100vh - 250px);
        margin: 0px;
        padding: 25px;
      }
      .editor-info {
        position: relative;
        background-color: rgb(250, 250, 250);
        width: calc(100% - 10px);
        height: 40px;
        margin: 0px;
        padding: 5px;
        /*box-shadow: 0px 0px 10px rgba(200, 200, 200);*/
      }

      /* Context Menu */
      .context {
        display: none;
        position: absolute;
        background-color: rgb(255, 255, 255);
        width: 200px;
        min-height: 100px;
        margin: 0px;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(200, 200, 200, 0.5);
        z-index: 5;
      }
      .context-item {
        background-color: rgb(255, 255, 255);
        width: 100%;
      }
      .context-item:hover {
        background-color: rgb(250, 250, 250);
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <!-- ReEdit Icon -->
      <img class="main-icon" src="resources/pencil.png" alt="Pencil Icon">
      <!-- ReEdit Text -->
      <div class="header-text">
        <h1>ReEdit</h1>
      </div>
      <!-- Options Container -->
      <div class="options-container">
        <!-- Run Icon -->
        <div class="icon-container run-icon-container">
          <img class="icon run-icon" src="resources/download.png" alt="Run Icon">
        </div>
        <!-- Download Icon -->
        <div class="icon-container download-icon-container">
          <img class="icon download-icon" src="resources/download.png" alt="Download Icon">
        </div>
        <!-- Account Icon -->
        <div class="icon-container account-icon-container">
          <img class="icon account-icon" src="resources/person.png" alt="Account Icon">
        </div>
        <!-- Settings Icon -->
        <div class="icon-container settings-icon-container">
          <img class="icon settings-icon" src="resources/gear.png" alt="Settings Icon">
        </div>
      </div>
    </div>
    <!-- Content -->
    <div class="content">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-tools-container">
          <div class="sidebar-search" contenteditable="true" onkeyup="updateSearch()">Search</div>
          <!--<div class="sidebar-options-container">
            <div class="sidebar-option-TEMPORARY">
              1
            </div>
            <div class="sidebar-option-TEMPORARY">
              2
            </div>
            <div class="sidebar-option-TEMPORARY">
              3
            </div>
            <div class="sidebar-option-TEMPORARY">
              4
            </div>
          </div>-->
        </div>
        <div class="sidebar-files">

        </div>
      </div>
      <!-- Editor -->
      <div class="editor-container">
        <!-- Tab Display -->
        <div class="editor-tabs">
        </div>
        <!-- Text Editor Display -->
        <div class="editor-text-container">

        </div>
        <!-- Info Display -->
        <div class="editor-info">
        </div>
      </div>
    </div>
    <!-- Context Menu -->
    <div class="context">
      <div class="context-item">
        context!
      </div>
    </div>
    <!-- Page Cover -->
    <div class="t0-5 cover">
      <!-- Settings Cover -->
      <div class="t0-5 settings">
        <div class="icon-container-close settings-icon-container-close">
          <img class="icon settings-icon" src="resources/gear.png" alt="Settings Icon">
        </div>
        <h1>Settings</h1><br>
        Welcome to settings!<br>
        There are currently no settings.
      </div>
      <!-- Account Cover -->
      <div class="t0-5 account">
        <div class="icon-container-close account-icon-container-close">
          <img class="icon account-icon" src="resources/person.png" alt="Account Icon">
        </div>
        <h1>Account</h1><br>
        Welcome to account!<br>
        You are not signed in.<br><br>
        <input type="text" id="username" placeholder="Username"><br>
        <input type="password" id="password" placeholder="Password"><br><br>
        <input type="checkbox" id="remember">Keep me logged in<br><br>
        <button onclick="login()" id="login">Login</button><br>
        <button onclick="createAccount()" id="createAccount">or Create an Account</button>
      </div>
      <!-- Download Cover -->
      <div class="t0-5 download">
        <div class="icon-container-close download-icon-container-close">
          <img class="icon download-icon" src="resources/download.png" alt="Download Icon">
        </div>
        <h1>Download</h1><br>
        Select the project(s) or file(s) to download:<br>
        < no projects or files >
      </div>
    </div>
    <script>
      // File Handling:
        /*

         VARIABLE SETUP:
          currentPath[]
           = The path to the currently open file
           - contains: numeric indicies
           - example: [0, 1, 4] would lead to files.contents[0].contents[1].contents[4]
          tabs[]
           = An array of open tabs
           - contains: path arrays
          files{}
           = An object that stores all the files
           - contains: folder and file objects
          account{}
           = Account data
           - label: [TODO]

        */
        var currentPath = [];
        var tabs = [];
        var files = {
          type: "folder",
          name: "Files",
          created: new Date().getTime(),
          saved: new Date().getTime(),
          open: true,
          contents: [
            {
              type: "folder",
              name: "Example Project",
              created: new Date().getTime(),
              saved: new Date().getTime(),
              open: true,
              contents: [
                {
                  type: "file",
                  name: "index",
                  extension: "html",
                  created: new Date().getTime(),
                  saved: new Date().getTime(),
                  contents: "<!DOCTYPE html>\n<!-- This is an example HTML project. Feel free to edit it! -->\n<html>\n  <head>\n    <title>An Example Project!</title>\n  <link rel=\"stylesheet\" href=\"stylesheet.css\">\n  </head>\n  <body>\n    <h1>Hello World!</h1>\n  </body>\n</html>"
                }, {
                  type: "file",
                  name: "stylesheet",
                  extension: "css",
                  created: new Date().getTime(),
                  saved: new Date().getTime(),
                  contents: "\n/* Here's an example CSS file within the HTML project. Feel free to edit it! */\n\nbody {\n  padding: 100px;\n}\nh1 {\n  font-family: Helvetica;\n}"
                }, {
                  type: "folder",
                  name: "resources",
                  created: new Date().getTime(),
                  saved: new Date().getTime(),
                  open: true,
                  contents: [
                    {
                      type: "file",
                      name: "resource1",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[1] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource2",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[2] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource3",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[3] This is an example resource file."
                    }
                  ]
                }, {
                  type: "folder",
                  name: "resources",
                  created: new Date().getTime(),
                  saved: new Date().getTime(),
                  open: false,
                  contents: [
                    {
                      type: "file",
                      name: "resource1",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[1] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource2",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[2] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource3",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[3] This is an example resource file."
                    }
                  ]
                }, {
                  type: "folder",
                  name: "resources",
                  created: new Date().getTime(),
                  saved: new Date().getTime(),
                  open: true,
                  contents: [
                    {
                      type: "file",
                      name: "thisIsAResourceFileWithAVeryLongName",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[1] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource2",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[2] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource3",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[3] This is an example resource file."
                    }
                  ]
                }, {
                  type: "folder",
                  name: "resources",
                  created: new Date().getTime(),
                  saved: new Date().getTime(),
                  open: true,
                  contents: [
                    {
                      type: "file",
                      name: "resource1",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[1] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource2",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[2] This is an example resource file."
                    }, {
                      type: "file",
                      name: "resource3",
                      extension: "txt",
                      created: new Date().getTime(),
                      saved: new Date().getTime(),
                      contents: "[3] This is an example resource file."
                    }
                  ]
                }
              ]
            }
          ]
        };
        var account = {
          loggedIn: false,
          username: ""/*,
          stayLoggedIn: false*/
        };

        /*

         PATH CONVERSIONS:
          stringifyPath(path)
           = Takes a path and turns it into a string
           - path: the path to the file
          objectifyPath(path)
           = Takes a stringified path and turns it back into a path
           - path: the stringified path

        */
        function stringifyPath(path) {
          return path.join("-");
        }
        function objectifyPath(path) {
          return path.split("-");
        }

        /*

          GET FUNCTIONS:
           getPath(path)
            = Returns the file/folder at the given path
            - path: the path to the file
            - example: getPath([0, 1]) -> the file at files.contents[0].contents[1]
           getID(path)
            = Returns the ID associated with that path
            - path: the path to the file
            - example: [assuming the file at the path [0, 1] is a folder] getID([0, 1]) -> "folder_0-1"

        */
        function getPath(path) {
          if (path === undefined) {
            return files;
          }
          var current = files;
          for (var i = 0; i < path.length; i++) {
            if (current.contents && current.type === "folder") {
              current = current.contents;
            }
            if (current[path[i]]) {
              current = current[path[i]];
            }
          }
          return current;
        }
        function getID(path) {
          var data = getPath(path);
          return data.type + "_" + stringifyPath(path);
        }

        /*

          SIDEBAR DISPLAY:
           toggleFolder(path)
            = Opens/closes the folder at the given path in the sidebar
            - path: the path to the folder
           displayFile(path)
            = Displays the file/folder at the given path in the sidebar
            - path: the path to the file
           displayAllFiles(path)
            = Displays all files within the given path in the sidebar
            - path: the path to the file

        */
        function toggleFolder(path) {
          getPath(path).open = !getPath(path).open;
          toggle("folder_" + stringifyPath(path) + "_contents", "sidebar-folder-contents");
          switchClass("sidebar-open", document.getElementById(getID(currentPath)));
          classifyParentPath(currentPath, "sidebar-open");
        }
        function displayFile(path) {
          var data = getPath(path);

          // Get the parent's path (the current path without the last value):
          var parentPath = [];
          for (var i = 0; i < path.length - 1; i++) {
            parentPath.push(path[i]);
          }

          // Get the parent element and the ID for the new element:
          var parent = document.getElementById("folder_" + stringifyPath(parentPath) + "_contents") || document.getElementsByClassName("sidebar-files")[0];
          var id = getID(path);

          // Create the new element:
          if (data.type === "folder") {
            parent.innerHTML += `
              <div class="sidebar-folder-container" id="` + (id + "_container") + `">
                <div class="sidebar-folder" id="` + id + `" onclick="toggleFolder([` + objectifyPath(id.split("_")[1]) + `])">
                  ` + data.name + `
                </div>
                <div class="t0-5 sidebar-folder-contents` + (data.open ? "" : " sidebar-folder-contents-active") + `" id="` + (id + "_contents") + `">

                </div>
              </div>
            `;
          } else {
            parent.innerHTML += `
              <div class="sidebar-file" id="` + id + `" onclick="openFile([` + path  + `])" onmouseover="addClass('editor-tab-linked', document.getElementById('tab_` + stringifyPath(path) + `') ? document.getElementById('tab_` + stringifyPath(path) + `') : false)" onmouseout="removeClass('editor-tab-linked')">
                ` + (data.name + "." + data.extension) + `
              </div>
            `;
          }
        }
        function displayAllFiles(path) {
          var p = getPath(path).contents;
          for (var i = 0; i < p.length; i++) {
            var newPath = [];
            for (var j = 0; j < (path ? path.length : 0); j++) {
              newPath.push(path[j]);
            }
            newPath.push(i);
            displayFile(newPath);
            if (p[i].type === "folder") {
              displayAllFiles(newPath);
            }
          }
        }
        // Display all the files in the sidebar:
        displayAllFiles();

        /*

          EDITOR DISPLAY:
           removeClass(cl)
            = Removes the given class from the element that currently has that class
            - cl: the class to be removed
           addClass(cl, el)
            = Adds the given class to the given element
            - cl: the class to be added
            - el: the new element the given class should be added to
           switchClass(cl, el)
            = Removes the given class from the element that currently has that class, then adds it to the given element
            - cl: the class to be switched
            - el: the new element the given class should be added to
           classifyParentPath(path, cl)
            = Adds the given class to the parent folder(s) if the parent folder(s) are closed
            - path: the path to the file
            - cl: the class to be added
           openFile(path)
            = Displays the file at the given path in the editor
            - path: the path to the file
           openTab(path)
            = Displays the file at the given path in the tab bar
            - path: the path to the file
           displayAllTabs()
            = Displays all the open tabs in the tab bar
           hoverTabLinked(path)
            = The file at the given path will light up when the tab with that same given path is hovered over
            - path: the path to the file
           openEditor(path)
            = Displays the file at the given path's contents in the editor
            - path: the path to the file

        */
        function removeClass(cl) {
          for (var i = 0; i < document.getElementsByClassName(cl).length; i++) {
            document.getElementsByClassName(cl)[i].classList.remove(cl);
            i--;
          }
        }
        function addClass(cl, el) {
          if (el) {
            el.classList.add(cl);
          }
        }
        function switchClass(cl, el) {
          removeClass(cl);
          addClass(cl, el);
        }
        function classifyParentPath(path, cl) {
          var curPath = [];
          for (var i = 0; i < path.length - 1; i++) {
            curPath.push(path[i]);
            if (!getPath(curPath).open) {
              addClass(cl, document.getElementById("folder_" + stringifyPath(curPath)));
            }
          }
        }
        function openFile(path) {
          switchClass("sidebar-open", document.getElementById(getID(path)));
          classifyParentPath(path, "sidebar-open");
          openTab(path);
          openEditor(path);
        }
        function openTab(path) {
          currentPath = path;
          var tabExists = tabs.indexOf(stringifyPath(path));
          var id = stringifyPath(path);
          if (tabExists === -1) {
            tabs.push(id);
            displayAllTabs();
          }
          switchClass("editor-tab-open", document.getElementById("tab_" + id));
        }
        function displayAllTabs() {
          document.getElementsByClassName("editor-tabs")[0].innerHTML = "";
          var id, path, data;
          for (var i = 0; i < tabs.length; i++) {
            id = tabs[i], path = objectifyPath(id), data = getPath(path);
            document.getElementsByClassName("editor-tabs")[0].innerHTML += `
              <div class="editor-tab` + (id === stringifyPath(currentPath) ? " editor-tab-open" : "") + `" id="tab_` + id + `" onclick="openFile([` + path + `])" draggable="true" ondragstart="tabDragStart('` + id + `')" ondragover="tabDragOver(event)" ondragend="tabDragEnd(event)" onmouseover="hoverTabLinked([` + objectifyPath(id) + `])" onmouseout="removeClass('sidebar-linked')">
                ` + (data.name + "." + data.extension) + `
              </div>
            `;
          }
        }
        function hoverTabLinked(path) {
          addClass('sidebar-linked', document.getElementById("file_" + stringifyPath(path)));
          classifyParentPath(path, "sidebar-linked");
        }
        function openEditor(path) {
          document.getElementsByClassName("editor-text-container")[0].innerText = getPath(path).contents;
        }

        /*

          TAB DRAGGING VARIABLES:
           tabDrag{}
            = Dragging data
            - contains: dragging (the tab being dragged) and over (the tab being dragged over) data
              - .el: the element being dragged/dragged over
              - .i: the index in the tabs[] array of the tab being dragged/dragged over

        */
        var tabDrag = {
          dragging: {
            el: false,
            i: false
          },
          over: {
            el: false,
            i: false
          }
        };

        /*

          TAB DRAGGING FUNCTIONS:
           tabDragStart(id)
            = Sets the tabDrag.dragging object when a tab is picked up to be dragged
            - id: the id of the tab
           tabDragOver(e)
            = Sets the tabDrag.over object when a tab is being dragged over and displays which side the tab that is being dragged will be dropped on
            - e: the event data for the element being dragged over
            - example: [asumming a tab is being dragged over the right side of tab 1] tabDragStart(e) -> tabDrag.dragging{} = {[data]}, black border on the right side of tab 1
           tabDragEnd(e)
            = Drops the tab that is being dragged where the user wants it and resets element classes and the tabDrag object
            - e: the event data for the element being dragged

        */
        function tabDragStart(id) {
          removeClass('sidebar-linked'); // Don't highlight the linked file while dragging
          tabDrag.dragging = {
            el: document.getElementById("tab_" + id),
            i: tabs.indexOf(id)
          };
        }
        function tabDragOver(e) {
          removeClass('sidebar-linked'); // Don't highlight the linked file while dragging
          e.preventDefault();
          tabDrag.over = {
            el: e.target,
            i: tabs.indexOf(e.target.id.split("_")[1])
          };
          if (tabDrag.dragging.el.id !== tabDrag.over.el.id) {
            if (mousePos(e).x < tabDrag.over.el.offsetLeft + tabDrag.over.el.offsetWidth / 2) { // Left
              if (!document.getElementsByClassName("editor-tab-over-left")[0] || tabDrag.over.el.id !== document.getElementsByClassName("editor-tab-over-left")[0].id) {
                removeClass("editor-tab-over-right");
                removeClass("editor-tab-over-left");
                addClass("editor-tab-over-left", tabDrag.over.el);
              }
            } else { // Right
              if (!document.getElementsByClassName("editor-tab-over-right")[0] || tabDrag.over.el.id !== document.getElementsByClassName("editor-tab-over-right")[0].id) {
                removeClass("editor-tab-over-right");
                removeClass("editor-tab-over-left");
                addClass("editor-tab-over-right", tabDrag.over.el);
              }
            }
          }
        }
        function tabDragEnd(e) {
          removeClass('sidebar-linked'); // Don't highlight the linked file while dragging
          if (tabDrag.dragging.el.id !== tabDrag.over.el.id) {
            var tabDragPath = tabs.splice(tabDrag.dragging.i, 1)[0];
            if (mousePos(e).x < tabDrag.over.el.offsetLeft + tabDrag.over.el.offsetWidth / 2) { // Left
              tabs.splice((tabDrag.dragging.i < tabDrag.over.i) ? (tabDrag.over.i - 1) : tabDrag.over.i, 0, tabDragPath);
            } else { // Right
              tabs.splice((tabDrag.dragging.i < tabDrag.over.i) ? (tabDrag.over.i) : (tabDrag.over.i + 1), 0, tabDragPath);
            }
            displayAllTabs();
          }
          removeClass("editor-tab-over-right");
          removeClass("editor-tab-over-left");
          tabDrag = {
            dragging: {
              el: false,
              i: false
            },
            over: {
              el: false,
              i: false
            }
          };
        }

        /*

          SEARCH FUNCTIONS:
           occurences(term, str)
            = Lists the number of times the given term occurs in the given string
            - term: the term being searched for in the string
            - str: the string to be searched in
           searchCheck(term, path)
            = Calculates a search score by searching through the file at the given path using the given term
            - term: the term to be searched for in the file at the given path's data
            - path: the path to the file/folder being searched
           search(term, path)
            = Calculates a search score for all the files/folders found in the given path using the given term
            - term: the term to be searched for
            - path: the path to the folder being searched

        */
        function occurences(term, str) {
          var occ = 0;
          for (var i = 0; i < str.length - (term.length - 1); i++) {
            if (str.substring(i, i + term.length) === term) {
              occ++;
            }
          }
          return occ;
        }
        function searchCheck(term, path) {
          var cur = getPath(path);
          var score = 0;
          if (cur.type === "folder") {
            score += occurences(term, cur.type.toLowerCase()); // Type
            score += occurences(term, cur.name.toLowerCase()); // Name
            score *= 5; // Folder Multiplier
          } else {
            score += occurences(term, cur.type.toLowerCase()); // Type
            score += occurences(term, cur.name.toLowerCase() + "." + cur.extension.toLowerCase()); // Name + Extension
            score += occurences(term, cur.contents.toLowerCase()); // Contents
          }
          return {
            path: path,
            score: score
          };
        }
        function search(term, path) {
          if (!term) {
            term = "";
          }
          term = term.toLowerCase();
          var results = [];
          var p = getPath(path).contents;
          // Get the results:
          for (var i = 0; i < p.length; i++) {
            // newPath = the current path + the current index (basically [path, i])
            var newPath = [];
            for (var j = 0; j < (path ? path.length : 0); j++) {
              newPath.push(path[j]);
            }
            newPath.push(i);
            results.push(searchCheck(term, newPath));
            if (p[i].type === "folder") {
              var tempResults = search(term, newPath);
              for (var j = 0; j < tempResults.length; j++) {
                results.push(tempResults[j]);
              }
            }
          }
          // Filter and sort results:
          var filteredResults = [];
          for (var i = 0; i < results.length; i++) {
            if (results[i].score === 0) {
              results.splice(i, 1);
              i--;
              continue;
            }
            filteredResults.push(results[i]);
          }
          quicksort(filteredResults, 0, filteredResults.length - 1, "score");
          return filteredResults;
        }
        function updateSearch() {
          var s = document.getElementById("sidebar-search");
          s.innerHTML = s.innerText;
          console.log("keyup!");
        }

        /*

          QUICKSORT FUNCTIONS:
           partition(arr, lo, hi, by)
            = The quicksort partition function; sorts the current partition based on the given "by" value
            - arr: the whole array
            - lo: the low end of the array to be partitioned / sorted
            - hi: the high end of the array to be partitioned / sorted
            - by (optional): what the object should be sorted by; leave blank when sorting arrays
           quicksort(arr, lo, hi, by)
            = The quicksort function; sorts an array based on the given "by" value
            - arr: the whole array
            - lo: the low end of the array to be partitioned
            - hi: the high end of the array to be partitioned
            - by (optional): what the object should be sorted by; leave blank when sorting arrays

        */
        function partition(arr, lo, hi, by) {
          var pivot = (by ? arr[hi][by] : arr[hi]);
          var i = lo;
          for (var j = lo; j < hi; j++) {
            if ((by ? arr[j][by] : arr[j]) > pivot) {
              if (i !== j) {
                var t = arr[j];
                arr[j] = arr[i];
                arr[i] = t;
              }
              i++;
            }
          }
          var t = arr[hi];
          arr[hi] = arr[i];
          arr[i] = t;
          return i;
        }
        function quicksort(arr, lo, hi, by) {
          if (lo < hi) {
            var p = partition(arr, lo, hi, by);
            quicksort(arr, lo, p - 1, by);
            quicksort(arr, p + 1, hi, by);
          }
        }

      //


      // Event Handling:
        /*

          HELPER FUNCTIONS:
           toggle(cl, ocl)
            = Toggles the class "given class + '-active'" on the elements with the given class
            - cl: the class; elements with this class will have the class "cl + '-active'" toggled
            - ocl (optional): overrides the class that elements with the given class should have toggled ("ocl + '-active'" will be toggled instead of "cl + '-active'")
           mousePos(e)
            = Returns the position of the mouse
            - e: the event data

        */
        function toggle(cl, ocl) {
          var el = document.getElementsByClassName(cl).length > 0 ? document.getElementsByClassName(cl) : [document.getElementById(cl)];
          ocl = ocl ? (ocl + "-active") : (cl + "-active");
          for (var i = 0; i < el.length; i++) {
            if (el[i].classList.contains(ocl)) {
              el[i].classList.remove(ocl);
            } else {
              el[i].classList.add(ocl);
            }
          }
        }
        function mousePos(e) {
          if (!e) {
            var e = window.event;
          }
          var mouseX = 0;
          var mouseY = 0;

          if (e.pageX || e.pageY) {
            mouseX = e.pageX;
            mouseY = e.pageY;
          } else if (e.clientX || e.clientY) {
            mouseX = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
            mouseY = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
          }
          // Add the scroll of the parent elements (excluding the element itself (not needed) plus body, html, document and window scolls, as those are already taken into consideration)
          if (e.path) {
            for (var i = 1; i < e.path.length - 4; i++) {
              mouseX += e.path[i].scrollLeft;
              mouseY += e.path[i].scrollTop;
            }
          }
          return {
            x: mouseX,
            y: mouseY
          }
        }

        /*

          COVER DISPLAY:
           toggleCover(icon)
            = Toggles the cover and displays the given icon's tab
            - icon: the name of the icon whose tab should be displayed on the cover (example: "settings")

        */
        var optionOpen = "";
        function toggleCover(icon) {
          // Open:
          document.getElementsByClassName(icon + "-icon-container")[0].onclick = function() {
            if (optionOpen === "") {
              optionOpen = icon;
              toggle("cover");
              toggle(icon);
              document.getElementsByClassName("cover")[0].style.pointerEvents = "auto";
              document.getElementsByClassName(icon)[0].style.pointerEvents = "auto";
            }
          }
          // Close:
          document.getElementsByClassName(icon + "-icon-container-close")[0].onclick = function() {
            if (optionOpen === icon) {
              optionOpen = "";
              toggle("cover");
              toggle(icon);
              document.getElementsByClassName("cover")[0].style.pointerEvents = "none";
              document.getElementsByClassName(icon)[0].style.pointerEvents = "none";
            }
          }
        }

        /*

          ON PAGE LOAD:
           #options
            = Sets the functions that toggle the cover when that option's icon is clicked
            - #options.settings: sets the functions that toggle the settings cover when the settings icon is clicked
            - #options.account: sets the functions that toggle the account cover when the account icon is clicked
            - #options.download: sets the functions that toggle the download cover when the download icon is clicked
           #run
            = Sets the function that runs when the run icon is clicked
           #context
            = Sets the functions that open/close the context menu
            - #context.open: displays the context menu at the mouse position when the contextmenu event is fired
            - #context.close: hides the context menu when the click event is fired using the left mouse button

        */
        window.onload = function() {
          // #options:
          toggleCover("settings"); // .settings
          toggleCover("account"); // .account
          toggleCover("download"); // .download

          // #run:
          document.getElementsByClassName("run-icon-container")[0].onclick = function() {
            alert("This feature does not work yet.");
          }

          // #context
          // .open
          document.getElementsByClassName("sidebar")[0].oncontextmenu = function(e) {
            e.preventDefault();

            var mp = mousePos(e);
            var mouseX = mp.x, mouseY = mp.y;
            var context = document.getElementsByClassName("context")[0];

            context.style.display = "block";
            context.style.left = mouseX + "px";
            context.style.top = mouseY + "px";

            console.log(mouseX + " " + mouseY);
          };
          // .close
          document.onclick = function(e) {
            var button = e.which || e.button;
            if (button === 1) {
              document.getElementsByClassName("context")[0].style.display = "none";
            }
          };
        };
      // End of script
    </script>
  </body>
</html>
